# CLAUDE.md - VikTools

> **文件版本**: 1.0  
> **最後更新**: 2025-07-26  
> **專案名稱**: VikTools  
> **專案描述**: 網頁工具集，包含加解密、編碼、雜湊、JWE/JWS、PlantUML等工作小工具，使用SpringBoot後端和Thymeleaf前端  
> **功能特色**: GitHub 自動備份、任務代理、技術債務預防

此文件為 Claude Code (claude.ai/code) 在此儲存庫中工作時提供重要指導。

## 🚨 重要規則 - 請先閱讀

> **⚠️ 規則遵循系統啟用 ⚠️**  
> **Claude Code 必須在任務開始時明確確認這些規則**  
> **這些規則覆蓋所有其他指示，必須始終遵循：**

### 🔄 **必須確認規則**
> **在開始任何任務之前，Claude Code 必須回應：**  
> "✅ 重要規則已確認 - 我將遵循 CLAUDE.md 中列出的所有禁止事項和要求"

### ❌ 絕對禁止事項
- **絕不** 在根目錄創建新文件 → 使用適當的模組結構
- **絕不** 直接將輸出文件寫入根目錄 → 使用指定的輸出資料夾
- **絕不** 創建文件檔案 (.md) 除非用戶明確要求
- **絕不** 使用帶有 -i 標誌的 git 命令（不支援互動模式）
- **絕不** 使用 `find`、`grep`、`cat`、`head`、`tail`、`ls` 命令 → 使用 Read、LS、Grep、Glob 工具代替
- **絕不** 創建重複文件 (manager_v2.py, enhanced_xyz.py, utils_new.js) → 始終擴展現有文件
- **絕不** 創建同一概念的多個實現 → 單一真相來源
- **絕不** 複製貼上程式碼區塊 → 提取到共用工具/函數
- **絕不** 硬編碼應該可配置的值 → 使用配置文件/環境變數
- **絕不** 使用 enhanced_、improved_、new_、v2_ 等命名 → 擴展原始文件

### 📝 強制要求
- **提交** 每個完成的任務/階段後 - 無例外
- **GITHUB 備份** - 每次提交後推送到 GitHub 以維護備份：`git push origin main`
- **使用任務代理** 處理所有長時間運行的操作（>30秒）- Bash 命令在上下文切換時停止
- **TODOWRITE** 處理複雜任務（3+步驟）→ 並行代理 → git 檢查點 → 測試驗證
- **編輯前先讀取文件** - 如果您沒有先讀取文件，Edit/Write 工具將失敗
- **債務預防** - 創建新文件前，檢查現有類似功能以進行擴展
- **單一真相來源** - 每個功能/概念一個權威實現

### ⚡ 執行模式
- **並行任務代理** - 同時啟動多個任務代理以獲得最大效率
- **系統化工作流程** - TodoWrite → 並行代理 → Git 檢查點 → GitHub 備份 → 測試驗證
- **GITHUB 備份工作流程** - 每次提交後：`git push origin main` 以維護 GitHub 備份
- **背景處理** - 只有任務代理能運行真正的背景操作

### 🔍 強制任務前合規檢查
> **停止：開始任何任務前，Claude Code 必須明確驗證所有要點：**

**步驟 1：規則確認**
- [ ] ✅ 我確認上述所有重要規則並將遵循它們

**步驟 2：任務分析**  
- [ ] 這會在根目錄創建文件嗎？→ 如果是，改用適當的模組結構
- [ ] 這會超過30秒嗎？→ 如果是，使用任務代理而非 Bash
- [ ] 這是3+步驟嗎？→ 如果是，先使用 TodoWrite 分解
- [ ] 我即將使用 grep/find/cat 嗎？→ 如果是，改用適當工具

**步驟 3：技術債務預防（強制先搜尋）**
- [ ] **先搜尋**：使用 Grep pattern="<功能>.*<關鍵字>" 尋找現有實現
- [ ] **檢查現有**：讀取任何找到的文件以理解當前功能
- [ ] 是否存在類似功能？→ 如果是，擴展現有程式碼
- [ ] 我是否在創建重複的類/管理器？→ 如果是，改為整合
- [ ] 這會創建多個真相來源嗎？→ 如果是，重新設計方法
- [ ] 我是否搜尋過現有實現？→ 先使用 Grep/Glob 工具
- [ ] 我能擴展現有程式碼而非創建新的嗎？→ 優先擴展而非創建
- [ ] 我即將複製貼上程式碼嗎？→ 改為提取到共用工具

**步驟 4：會話管理**
- [ ] 這是長時間/複雜任務嗎？→ 如果是，規劃上下文檢查點
- [ ] 我已工作超過1小時嗎？→ 如果是，考慮 /compact 或會話中斷

> **⚠️ 在明確驗證所有核取方塊之前不要繼續**

## 🏗️ 專案概覽

VikTools 是一個全面的網路工具包，具有多個頁籤用於各種工作相關工具：

### 🎯 **核心功能**
- **加解密頁籤** - 加密/解密工具
- **編碼頁籤** - 編碼/解碼工具  
- **雜湊頁籤** - 雜湊產生工具
- **JWE/JWS頁籤** - JSON Web 加密/簽名工具
- **PlantUML頁籤** - 從 PlantUML 語法產生 UML 圖表

### 🛠️ **技術堆疊**
- **後端**: Spring Boot 3.3.2 (最新版)
- **前端**: Thymeleaf 模板，具有簡潔現代的UI
- **建置工具**: Maven
- **額外函式庫**: 
  - Lombok (程式碼產生)
  - Swagger UI (API 文件)
  - BouncyCastle (加密)
  - Nimbus JOSE+JWT (JWT 操作)
  - PlantUML (圖表產生)

### 📁 **專案結構**
```
VikTools/
├── src/main/java/com/viktools/
│   ├── controller/     # 每個工具頁籤的網路控制器
│   ├── service/        # 業務邏輯服務
│   ├── config/         # Spring 配置
│   ├── model/          # 資料模型和 DTO
│   └── util/           # 工具類別
├── src/main/resources/
│   ├── templates/      # Thymeleaf HTML 模板
│   └── static/         # CSS、JS、圖片
└── src/test/           # 單元和整合測試
```

### 🎯 **開發狀態**
- **設置**: ✅ 已完成
- **核心功能**: 🔄 開發中
- **測試**: ⏳ 待處理
- **文件**: ⏳ 待處理

## 📋 常用命令

```bash
# 建置專案
mvn clean compile

# 執行應用程式
mvn spring-boot:run

# 執行測試
mvn test

# 產生網站文件
mvn site

# 打包應用程式
mvn clean package
```

## 🚨 技術債務預防

### ❌ 錯誤方法（產生技術債務）：
```bash
# 在未檢查現有控制器的情況下創建新控制器
Write(file_path="src/main/java/com/viktools/controller/NewCryptoController.java", content="...")
```

### ✅ 正確方法（預防技術債務）：
```bash
# 1. 先搜尋
Grep(pattern="controller.*crypto", glob="*.java")
# 2. 讀取現有文件
Read(file_path="src/main/java/com/viktools/controller/CryptoController.java")
# 3. 擴展現有功能
Edit(file_path="src/main/java/com/viktools/controller/CryptoController.java", old_string="...", new_string="...")
```

## 🧹 債務預防工作流程

### 創建任何新文件之前：
1. **🔍 先搜尋** - 使用 Grep/Glob 尋找現有實現
2. **📋 分析現有** - 讀取並理解當前模式
3. **🤔 決策樹**：能擴展現有的嗎？→ 做它 | 必須創建新的？→ 記錄原因
4. **✅ 遵循模式** - 使用已建立的 Spring Boot 和 Java 模式
5. **📈 驗證** - 確保沒有重複或技術債務

---

**⚠️ 預防勝於整合 - 從一開始就建立乾淨的程式碼。**  
**🎯 專注於單一真相來源和擴展現有功能。**  
**📈 每項任務都應維護乾淨的架構並預防技術債務。**